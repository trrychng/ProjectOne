<!DOCTYPE html>
<html lang="en">

<head>
   <!-- Required meta tags -->
    <meta charset="utf-8">
  <title>Pub Crawler</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Latest compiled and minified CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">    
    
    <link rel="stylesheet" href="./assets/css/styles_ui.css">

</head>

<body>

<div class="container outter-wrapper">
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span> 
          </button>
          <a class="navbar-brand" href="#">Pub Crawler</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
 
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#"><span class="glyphicon glyphicon-user"></span> Username</a></li>
            <li id="login-button"><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
          </ul>
        </div>
      </div> <!-- container-fluid 1 -->
    </nav>
    
    <div class="stage">
 <!-- tab button -->
      <div class="tab-buttons">
        <ul class="nav nav-pills nav-justified">
          <li class="active"><a data-toggle="pill" href="#event">Events</a></li>
          <li><a data-toggle="pill" href="#overview">Overview</a></li>
          <li><a data-toggle="pill" href="#map">Map</a></li>
        </ul>

      </div>
      <div class="tab-content">

 <!-- EVENTS -->
        <div id="event" class="tab-pane fade in active events">
          <div class="section-header">

            <button id="addEvent-btn" class="add-btn">
              <span class="glyphicon glyphicon-plus"> </span>
            </button>

            <button class="edit-btn">
              <span>Edit</span>
              <span class="glyphicon glyphicon-edit"> </span>
            </button>
          </div>

          <ul class="list-group" id="event-list">
            <!-- <li class="list-group-item event-item SELECTED" id="Event 1">Event 1</li> -->

          </ul>
        </div>
 <!-- OVERVIEW -->
        <div id="overview" class="tab-pane fade overview">
          <div class="section-header">
 <!-- When in overview this should change to currently selected -->
            <h3 class="event-title">Pub 1</h3>
            <p class="event-loc">location</p>
            <p>Amount <span>$0</span></p>


            <button class="cal-btn">Calculate</button>
          </div>

          <div id="display">

          </div>
        </div>
 <!-- MAP -->
        <div id="map" class="tab-pane fade map">
          <h3>Map</h3>
          <p> </p>
        </div>
      </div> <!-- nav-pills -->

<!-- Add mod slides up -->
      <div id="add" class="mod">
        <div class="mod-content" id="add-mod-content">
          <div class="mod-header">
            <button class="cancel-btn">Cancel</button>
            <button class="done-btn">Done</button>
          </div>  <!-- mod-header -->
          
          <div class="form-wrapper">
            <form action=" " id="event-form">
              <div class="form-group">
                <input type="text" class="form-control" id="name-event" placeholder="PLACE">
              </div>
              <div class="form-group">
                <input type="location" class="form-control" id="loc-event" placeholder="LOCATION">
              </div>

              <div class="form-group guest-list">
                <div>
                  <input type="text" class="form-control guest" data-index="1" id="name-" placeholder="NAME">
                  <input type="text" class="form-control amount" data-index="1" id="name-" placeholder="AMOUNT">
                </div>
              </div>
            </form>
            
            <div class="add-guest-btn" id="scroll-here" ><a href="#scroll-here"><span class="glyphicon glyphicon-plus-sign"></span> Add Guest</a></div>
          </div>  <!-- form-wrapper -->

        </div>  <!-- add-mod-conten -->

      </div>  <!-- add mod -->

<!-- Edit mod slides up -->
      <div id="edit" class="mod">
        <div class="mod-content" id="add-mod-content">
          <div class="mod-header">
            <button class="cancel-btn">Cancel</button>
            <button class="done-btn">Done</button>
          </div>  <!-- mod-header -->
          
          <div class="form-wrapper">
            <form action=" " id="edit-form">
              <div class="form-group">

              <div class="form-group guest-list">
                <div><input type="text" class="form-control guest" data-index="0" id="name-" placeholder="NAME"></div>
                <input type="text" class="form-control amount" data-index="1" id="name-" placeholder="AMOUNT">
              </div>
            </form>
            
            <div class="add-guest-btn" id="scroll-here" ><a href="#scroll-here"><span class="glyphicon glyphicon-plus-sign"></span> Add Guest</a></div>
          </div>  <!-- form-wrapper -->

        </div>  <!-- add-mod-conten -->

      </div>  <!-- edit mod -->
  </div> <!-- stage -->

  <!-- Login window content -->
<!--   <div class="modal fade" id="loginModal" role="dialog">
    <div class="modal-dialog">
    

      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Login</h4>
        </div>
        <div class="modal-body" >
          <form role="form">
            <div class="form-group">
              <label for="usrname"><span class="glyphicon glyphicon-user"></span> Username</label>
              <input type="text" class="form-control" id="usrname" placeholder="Enter email">
            </div>
            <div class="form-group">
              <label for="psw"><span class="glyphicon glyphicon-eye-open"></span> Password</label>
              <input type="text" class="form-control" id="psw" placeholder="Enter password">
            </div>
            <div class="checkbox">
              <label><input type="checkbox" value="" checked>Remember me</label>
            </div>
              <button type="submit" class="btn btn-success btn-block"><span class="glyphicon glyphicon-off"></span> Login</button>
          </form>
        </div>
        <div class="modal-footer">
          <p><a href="#">Sign Up</a></p>

          <p><a href="#">Sign Up</a> / Forgot <a href="#">Password?</a></p>
        </div>
      </div>
      
    </div>
  </div> -->  <!-- Modal -->

  <footer class="footer">
    <div class="container">
      <span class="text-muted">2018</span>
    </div>
  </footer>
</div> <!-- container -->


<!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!--   <script type="text/javascript" src="assets/javascript/logic.js"></script> -->

  <script type="text/javascript" src="assets/javascript/login.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>

  <script>

    var current_form =  $(".mod-content").find("#event-form");
    var event_teplate = $('#people-template').html();
    var event_list = $("#event-list");
    var person_list = $(".person-list");
    var mode;
    var saveInfo;

    var guest_field = '<input type="text" class="form-control guest" data-index="1" placeholder="NAME">';
    var amount_field = '<input type="text" class="form-control amount" data-index="1" placeholder="AMOUNT">';

    var current_selec;

    var event_id = event_list.find(".SELECTED").attr("id");

    var editForm = $("#edit-form");

    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyDIyoNcQc7sOf_wYKAwMM5CwxFK-z5Ysyc",
      authDomain: "pub-crawl-21b1d.firebaseapp.com",
      databaseURL: "https://pub-crawl-21b1d.firebaseio.com",
      projectId: "pub-crawl-21b1d",
      storageBucket: "pub-crawl-21b1d.appspot.com",
      messagingSenderId: "478647783482"
    };
    firebase.initializeApp(config);

    var database = firebase.database();

// Child Added
  database.ref("events").on("child_added", function(snapshot) {
    data = snapshot.val();

    console.log(data);

    renderList(data);
  });

// Add New Event
    function renderList(data) {

      if ( data == null) return;

      event_list.find("li").removeClass("SELECTED");
      
      var event_templete = '<li class="list-group-item event-item">';
        
      var event_item = $(event_templete);

      event_item.text(data.place).attr("id", data.place).addClass("SELECTED");

      current_selec = data.place;

      event_list.prepend(event_item);
    };
    function addEvent() {
        var form = form;

        var event_name = $("#name-event").val().trim();
        var event_loc = $("#loc-event").val().trim();

        var guestList = $('.guest-list').find(".guest");
        var userAmount = $('.guest-list').find(".amount");

console.log(userAmount);

        if ( event_name !== "" ) {


          var data = {
            place : event_name,
            location : event_loc,
            users: [],
            amount: 0
          }
  
  
          for ( var i = 0; i < guestList.length; i++) {
            var name = $(guestList[i]).val().trim();
            var amount = $(userAmount[i]).val();
            
            data.users.push( [name, amount] );
          };


          database.ref("events/" + event_name).set(data);

        }

        resetForm();
    };
    function editEvent() {
      var eventName_input = $('#edit-name-event');
      var eventLoc_input = $('#edit-loc');
      var guestName_input = '<input type="text" class="form-control guest" data-index="0" placeholder="NAME">';

      var appendItems = [];

      database.ref("events").once("value", function(snapshot){
          var data = snapshot.val();
          

          var event = data[current_selec];
          
          editForm.append( $("eventName_val").val(current_selec) )

          console.log(event.place);

      });
    };

    function setData() {
        var event_name = $("#name-event").val().trim();
        var event_loc = $("#loc-event").val().trim();

    };

    function resetForm() {
      var div = $("<div>")
      div.append(guest_field);
      div.append(amount_field);

      console.log("reset");

      current_form.find(".guest-list").html(div);
      editForm.find(".guest-list").html(div);

      current_form.find("input").val("");
    };
      $(document).ready(function() {

        $("#loginBtn").on("click", function(){
            $("#loginModal").modal();
            // console.log("GO");
        });

        // On click for Add and Edit button
        $(".section-header").on("click touchend", "button", function(event) {
            var target = $(this);
            var active = target.parents(".active").attr("id");
            $("#name-event").focus();
            
            if ( $(target).hasClass("add-btn") ) {
              $("body").addClass("ADDING");
              mode = "ADD";
              // ADD event function
              // Set function to addEvent
              saveData = addEvent;

            }else
            if ( $(target).hasClass("edit-btn") ) {
              $("body").addClass("EDITING");
              mode = "EDIT";
              // EDIT event function
              editEvent();
              // Set function to setData
              saveData = setData;

            }else {

            }
            // console.log(target);
        });

        $(".mod-header").on("click touchend", "button", function(event) {
            var target = event.target;
            // console.log( $(target) );

            if ( $(target).hasClass("cancel-btn") ) {
              // console.log("CANCEL");
              resetForm();
            }else
            if ( $(target).hasClass("done-btn") ) {
              // console.log("DONE");

              // EDIT EVENT HERE
              saveData();
            }

            $("body").removeClass();
        });
// Add new guest
        $(".add-guest-btn").on("click touchend", function(event) {
          var guestInputs = $(".guest-list");
          // var i = guestInputs.find(".guest").length + 1;
          // var add_input = $(guest_field).attr("data-index", i);

          var div = $("<div>")
          div.append(guest_field);
          div.append(amount_field);
          guestInputs.append(div);

        });

// Add class SELECTED on Event when clicked
        $("#event-list").on("click touchend", ".event-item", function(event) {
            $(this).parent().find("li").removeClass("SELECTED");
            var target = event.target;
            $(target).addClass("SELECTED");
            current_selec = event_id = event_list.find(".SELECTED").attr("id");

            console.log(event_id);

            $(".event-title").text(event_id);            
            
            database.ref("events").once("value", function(snapshot){
              var data = snapshot.val();

              $(".event-loc").text(data[event_id].location);
              
              var users = data[event_id].users;

              for (var i = 0; i < users.length; i++) {
                var name = users[i][0];
                var value = users[i][1];

                console.log(value);
              }
              
              $("#display").html("");
              

              $("#display").append( );


            });

        });

      });
  </script>
</body>

</html>