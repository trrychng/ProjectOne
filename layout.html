<!DOCTYPE html>
<html lang="en">

<head>
   <!-- Required meta tags -->
    <meta charset="utf-8">
  <title>Pub Crawler</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Latest compiled and minified CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">    
    
    <link rel="stylesheet" href="./assets/css/styles_ui.css">

</head>

<body>

<div class="container outter-wrapper">
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span> 
          </button>
          <a class="navbar-brand" href="#">Pub Crawler</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
 
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#"><span class="glyphicon glyphicon-user"></span> Username</a></li>
            <li id="loginBtn"><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
          </ul>
        </div>
      </div> <!-- container-fluid 1 -->
    </nav>
    
    <div class="stage">
 <!-- tab button -->
      <div class="tab-buttons">
        <ul class="nav nav-pills nav-justified">
          <li class="active"><a data-toggle="pill" href="#event">Events</a></li>
          <li><a data-toggle="pill" href="#overview">Overview</a></li>
          <li><a data-toggle="pill" href="#map">Map</a></li>
        </ul>

      </div>
      <div class="tab-content">

 <!-- EVENTS -->
        <div id="event" class="tab-pane fade in active events">
          <div class="section-header">

            <button id="addEvent-btn" class="add-btn">
              <span class="glyphicon glyphicon-plus"> </span>
            </button>

            <button class="edit-btn">
              <span>Edit</span>
              <span class="glyphicon glyphicon-edit"> </span>
            </button>
          </div>

          <ul class="list-group" id="event-list">
            <!-- <li class="list-group-item event-item SELECTED" id="Event 1">Event 1</li> -->

          </ul>
        </div>
 <!-- OVERVIEW -->
        <div id="overview" class="tab-pane fade overview">
          <div class="section-header">
 <!-- When in overview this should change to currently selected -->
            <h3 class="event-title">Pub 1</h3> <p>Amount <span>$0</span></p>

            <button class="cal-btn">Calculate</button>
          </div>

          <ul class="list-group person-list">
<!--             <li class="list-group-item person-item" id="person-1">Person 1 <span class="glyphicon glyphicon-remove-circle remove-btn"></span></li> -->

          </ul>
        </div>
 <!-- MAP -->
        <div id="map" class="tab-pane fade map">
          <h3>Map</h3>
          <p> </p>
        </div>
      </div> <!-- nav-pills -->

<!-- Add/Edit window slides up -->
      <div id="mod">
        <div class="mod-content">
          <div class="mod-header">
            <button class="cancel-btn">Cancel</button>
            <button class="done-btn">Done</button>
          </div>  <!-- mod-header -->
          
          <div class="form-wrapper">
            <form action=" " id="event-form">
              <div class="form-group">
                <input type="text" class="form-control" id="name-event" placeholder="EVENT NAME">
              </div>
              <div class="form-group">
                <input type="location" class="form-control" id="loc-event" placeholder="LOCATION">
              </div>

              <div class="form-group guest-list">
                <div><input type="text" class="form-control guest" data-index="0" id="name-" placeholder="NAME"></div>
              </div>
            </form>
            
            <div class="add-guest-btn" id="scroll-here" ><a href="#scroll-here"><span class="glyphicon glyphicon-plus-sign"></span> Add Guest</a></div>
          </div>  <!-- form-wrapper -->

        </div>  <!-- mod-conten -->
      </div>  <!-- mod -->

  </div> <!-- stage -->

  <!-- Login window content -->
  <div class="modal fade" id="loginModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content -->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Login</h4>
        </div>
        <div class="modal-body" >
          <form role="form">
            <div class="form-group">
              <label for="usrname"><span class="glyphicon glyphicon-user"></span> Username</label>
              <input type="text" class="form-control" id="usrname" placeholder="Enter email">
            </div>
            <div class="form-group">
              <label for="psw"><span class="glyphicon glyphicon-eye-open"></span> Password</label>
              <input type="text" class="form-control" id="psw" placeholder="Enter password">
            </div>
            <div class="checkbox">
              <label><input type="checkbox" value="" checked>Remember me</label>
            </div>
              <button type="submit" class="btn btn-success btn-block"><span class="glyphicon glyphicon-off"></span> Login</button>
          </form>
        </div>
        <div class="modal-footer">
          <p><a href="#">Sign Up</a></p>

          <!-- <p><a href="#">Sign Up</a> / Forgot <a href="#">Password?</a></p> -->
        </div>
      </div>
      
    </div>
  </div>  <!-- Modal -->

  <footer class="footer">
    <div class="container">
      <span class="text-muted">2018</span>
    </div>
  </footer>
</div> <!-- container -->


<!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <!-- <script type="text/javascript" src="assets/javascript/logic.js"></script> -->

  <script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>

  <script>

    var current_form =  $(".mod-content").find("#event-form");
    var event_teplate = $('#people-template').html();
    var event_list = $("#event-list");
    var person_list = $("#person-list");
    var mode;
    var saveInfo;

    var event_id = event_list.find(".SELECTED").attr("id");
    var guest_field = '<input type="text" class="form-control guest" data-index="0" placeholder="NAME">';

    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyDIyoNcQc7sOf_wYKAwMM5CwxFK-z5Ysyc",
      authDomain: "pub-crawl-21b1d.firebaseapp.com",
      databaseURL: "https://pub-crawl-21b1d.firebaseio.com",
      projectId: "pub-crawl-21b1d",
      storageBucket: "pub-crawl-21b1d.appspot.com",
      messagingSenderId: "478647783482"
    };
    firebase.initializeApp(config);

    var database = firebase.database();

    function writeUserData(userId, name, email, imageUrl) {
      firebase.database().ref('users/' + userId).set({
        username: name,
        email: email,
        profile_picture : imageUrl
      });
    };


    function addEvent() {
        var form = form;
        var event_templete = $('<li class="list-group-item event-item">');

        var event_name = $("#name-event").val().trim();
        var event_loc = $("#loc-event").val().trim();

        if ( event_name !== "" ) {
          event_templete.text(event_name).attr("id", event_name).addClass("SELECTED");
          
          event_list.find("li").removeClass("SELECTED");
          event_list.append(event_templete);
        }
        resetForm();
    };
    function editEvent(){
      var data = eventData.find( function(x) { return x.eventName == event_id } );

      $("#name-event").val(data.eventName);
      $("#loc-event").val(data.eventLoc);

    };
    function setData() {
        var event_name = $("#name-event").val().trim();
        var event_loc = $("#loc-event").val().trim();
    };

    function resetForm() {          
      var div = $("<div>").append(guest_field);

      current_form.find(".guest-list").html(div);
      current_form.find("input").val("");
    };
      $(document).ready(function(){

        $("#loginBtn").on("click", function(){
            $("#loginModal").modal();
            console.log("GO");
        });

        // On click for Add and Edit button
        $(".section-header").on("click touchend", "button", function(event) {
            var target = $(this);
            var active = target.parents(".active").attr("id");

            if ( $(target).hasClass("add-btn") ) {
              $("body").addClass("mod");
              mode = "ADD";
              // ADD event function
              // Set function to addEvent
              saveData = addEvent;

            }else
            if ( $(target).hasClass("edit-btn") ) {
              $("body").addClass("mod");
              mode = "EDIT";
              // EDIT event function
              editEvent();
              // Set function to setData
              saveData = setData;

            }else {

            }
            // console.log(target);
        });

        $(".mod-header").on("click touchend", "button", function(event) {
            var target = event.target;
            console.log( $(target) );

            if ( $(target).hasClass("cancel-btn") ) {
              // console.log("CANCEL");
              resetForm();
            }else
            if ( $(target).hasClass("done-btn") ) {
              // console.log("DONE");

              // EDIT EVENT HERE
              saveData();
            }

            $("body").removeClass();
        });
// Add new guest
        $(".add-guest-btn").on("click touchend", function(event) {
          var guestInputs = $(".guest-list");
          var i = guestInputs.find(".guest").length;

          $(guest_field).attr("data-index", i);

          var div = $("<div>").append(guest_field);

          guestInputs.append(div);

          // $(".form-wrapper").css({"overflow-y": "scroll"});

        });

// Add class SELECTED on Event when clicked
        $("#event-list").on("click touchend", ".event-item", function(event) {
            $(this).parent().find("li").removeClass("SELECTED");
            var target = event.target;
            $(target).addClass("SELECTED");
            event_id = event_list.find(".SELECTED").attr("id");
            console.log(event_id);
        });


      });
  </script>
</body>

</html>